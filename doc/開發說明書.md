# Printing IoT 系統開發說明書

**建立日期**： 2026/01/18
**主要 AI 模型**： Gemini 2.0 Flash
**開發者**： Antigravity

---

## 1. 專案概觀 (Project Overview)

### 1.1 這是什麼？
**一句話描述**： 這是一個針對印刷機台設計的即時監控與生產管理 Web Dashboard 系統，具備多語系支援 (中/英/越/泰)。

**解決的問題**：
- 即時可視化生產數據 (車速、產量、良率)，取代傳統紙本記錄。
- 支援多國籍操作員 (台灣、越南、泰國) 的語言需求，降低溝通障礙。
- 提供排程管理與生產報表分析功能。

### 1.2 主要功能
- **Dashboard (儀表板)**： 即時監控機台狀態、顯示生產計數、異常警示 (F3/F4 等操作邏輯)。
- **Schedule (排程管理)**： 訂單排程的 CRUD (新增/修改/刪除/排序)，支援拖拉或按鈕調整順序。
- **Reports & Analysis (報表與分析)**： 提供日報/月報查詢，以及多維度的圖表分析 (Chart.js)。
- **Multi-language (多語系)**： 支援 繁中/簡中/英文/越南/泰文 切換。

---

## 2. 系統架構與邏輯 (Architecture & Logic)

### 2.1 檔案結構 (Frontend Focus)
```text
Printing IoT/frontend/
├── src/
│   ├── pages/
│   │   ├── Dashboard.jsx        # 主監控介面 (F-Key 邏輯核心)
│   │   ├── Schedule.jsx         # 排程管理頁面
│   │   └── AnalysisPage.jsx     # 生產分析圖表頁面
│   ├── modules/
│   │   ├── language/
│   │   │   ├── LanguageContext.jsx  # 多語系 Context (核心字典)
│   │   │   └── LanguageSwitcher.jsx # 語言切換元件
│   │   └── reports/
│   │       └── ReportsPage.jsx      # 報表主頁面
│   ├── components/
│   │   └── modals/              # 各類彈出視窗 (完工、停車原因等)
│   └── App.jsx                  # 路由與 Context Provider 配置
```

### 2.2 核心運作流程
1.  **啟動與初始化**： App 啟動時載入 `LanguageProvider`，讀取瀏覽器或預設語言設定。
2.  **Dashboard 監控**： `Dashboard.jsx` 透過 `useEffect` 監聽鍵盤 F-Key (F1-F12)，觸發 API 呼叫 (如 `addLog`) 並彈出對應 Modal (如 `FinishOrderModal`)。所有 UI 文字透過 `t('key')` 動態取得。
3.  **排程管理**： `Schedule.jsx` 讀取排程列表，使用者可透過按鈕 (新增/修改) 呼叫 Modal 更新狀態，變更即時反映於 Dashboard。
4.  **報表分析**： `AnalysisPage.jsx` 讀取歷史資料 (localStorage 或 API)，利用 Chart.js 渲染圖表。圖表標籤與篩選選項皆透過 `t()` 進行翻譯。

---

## 3. AI 協作紀錄 (AI Prompts & Context)

### 3.1 關鍵 Prompt (指令) 備份
**生成翻譯邏輯：**
> "請將 Dashboard.jsx 中的硬編碼中文文字 (如 '車速', '生產數量') 全部替換為 `t()` 函數調用，並在 LanguageContext.jsx 中建立對應的翻譯鍵值 (Traditional Chinese, Simplified Chinese, English)。"

**修復組件邏輯：**
> "在 AnalysisPage.jsx 中，`availableCategoryFields` 是在組件外部定義的常量，導致無法使用 `t()` hook。請將其移至組件內部並改寫為使用 `t()` 的形式。"

**Modal JSX 修復：**
> "修復 FinishOrderModal.jsx 中因替換文字而意外破壞的 `<label>` 標籤結構，確保 Checkbox 能正確顯示並與文字對齊。"

### 3.2 AI 賦予的特殊規則
- **翻譯策略**： 優先保留原有 UI 佈局，使用 `LanguageContext` 集中管理所有字典，避免分散在各檔案。
- **元件封裝**： 對於複雜的圖表設定 (Chart Config)，建議將文字定義移入 Render Scope 以支援即時語言切換。

---

## 4. 環境設定與安裝 (Setup)

**程式語言版本**：
- Frontend: Node.js 18+ (Vite + React)
- Backend: C# .NET 8 (Docker Containerized)

**依賴套件 (Dependencies)**：
- `react`, `react-dom`: UI 核心
- `chart.js`, `react-chartjs-2`: 圖表繪製
- `xlsx`: 報表匯出
- custom `LanguageContext`: 輕量級 i18n 解決方案

**環境變數 (.env)**：
- `VITE_API_BASE_URL`: 後端 API 地址 (例: `http://localhost:5000`)

---

## 5. 學習筆記與踩坑紀錄 (Learning Notes)

**問題 1： 靜態常數無法翻譯**
- **狀況**： 在 `AnalysisPage` 中，圖表選項定義在 `const` 全域變數，導致語言切換時文字不會更新。
- **解法**： 將常數定義移入 Component Function 內部，或改為 `useMemo` 依賴 `t` 函數，確保語言變更時重新計算。

**問題 2： JSX 結構破壞**
- **狀況**： 使用自動化工具批量替換文字時，意外刪除了 `<label>` 的開頭標籤，導致 UI 跑版。
- **解法**： 在進行批量替換時，需精確匹配 Opening/Closing Tags，或使用更小範圍的精確替換。

**新知識**：
- 建立了一個可擴展的 `t(key)` 機制，支援巢狀 Key (如 `dashboard.monitor.speed`)，讓翻譯檔結構更清晰易讀。

---

## 6. 待辦事項與未來展望 (Roadmap)
- [ ] **VN/TH 翻譯補全**： 完成越南文與泰文的翻譯字典 (`LanguageContext.jsx`)。
- [ ] **Maintenance Module**： 將 `MaintenancePage` 與相關 Modal 納入翻譯範圍。
- [ ] **Backend Integration**： 確保後端回傳的動態訊息 (Error Messages) 也能支援多語系 (或透過 Error Code 前端轉譯)。
